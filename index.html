<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé∞ Welvura Casino - –ò–≥—Ä—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–µ–Ω—å–≥–∏</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <style>
        /* –°—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ, –∫–∞–∫ –≤ –≤–∞—à–µ–º —Ñ–∞–π–ª–µ */
        /* ... –≤—Å–µ —Å—Ç–∏–ª–∏ –∏–∑ –≤–∞—à–µ–≥–æ —Ñ–∞–π–ª–∞ ... */
        
        /* –î–æ–±–∞–≤–∏–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loader {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        .loader.active {
            display: flex;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #3498db;
            border-top: 5px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loader-text {
            margin-top: 20px;
            color: white;
            font-size: 16px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div class="loader" id="loader">
        <div class="spinner"></div>
        <div class="loader-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <div class="container">
        <!-- –í–µ—Å—å HTML –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–∞–∫–∏–º –∂–µ –∫–∞–∫ –≤ –≤–∞—à–µ–º —Ñ–∞–π–ª–µ -->
        <!-- ... –≤–µ—Å—å HTML –∏–∑ –≤–∞—à–µ–≥–æ —Ñ–∞–π–ª–∞ ... -->

    <script>
        // ========== –ù–ê–°–¢–†–û–ô–ö–ê FIREBASE ==========
        // –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è —Å–≤–æ–∏–º–∏ –∏–∑ Firebase Console
        const firebaseConfig = {
            apiKey: "AIzaSyBbzuHpOGUMiyUoOk2zEiWYdMeQa5I-FE8",
            authDomain: "welvura-casino.firebaseapp.com",
            projectId: "welvura-casino",
            storageBucket: "welvura-casino.firebasestorage.app",
            messagingSenderId: "541518861412",
            appId: "1:541518861412:web:b6b65d36b482d26bf0bb71"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        let firebaseApp;
        let db;
        let auth;

        async function initializeFirebase() {
            try {
                showLoader('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...');
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase
                firebaseApp = firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                auth = firebase.auth();
                
                console.log('Firebase —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
                auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ—à–µ–ª
                        await loadUserFromFirebase(user.uid);
                    } else {
                        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—à–µ–ª
                        showAuthPanel();
                    }
                    hideLoader();
                });
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö', 'error');
                hideLoader();
                // Fallback –Ω–∞ localStorage
                initLocalDatabase();
            }
        }

        // ========== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ó–ê–ì–†–£–ó–ö–û–ô ==========
        function showLoader(text = '–ó–∞–≥—Ä—É–∑–∫–∞...') {
            const loader = document.getElementById('loader');
            const loaderText = loader.querySelector('.loader-text');
            loaderText.textContent = text;
            loader.classList.add('active');
        }

        function hideLoader() {
            const loader = document.getElementById('loader');
            loader.classList.remove('active');
        }

        // ========== –û–ë–õ–ê–ß–ù–ê–Ø –ë–ê–ó–ê –î–ê–ù–ù–´–• FIREBASE ==========
        
        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function registerFirebase(username, password) {
            try {
                showLoader('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è...');
                
                // –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Firebase Auth
                const userCredential = await auth.createUserWithEmailAndPassword(
                    `${username}@welvura.com`, 
                    password
                );
                
                const user = userCredential.user;
                
                // –°–æ–∑–¥–∞–µ–º –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Firestore
                const userData = {
                    username: username,
                    balance: 1000.00,
                    registerDate: new Date().toISOString(),
                    lastLogin: new Date().toISOString(),
                    totalGames: 0,
                    wins: 0,
                    losses: 0,
                    gameHistory: [],
                    email: `${username}@welvura.com`
                };
                
                await db.collection('users').doc(user.uid).set(userData);
                
                return { ...userData, id: user.uid };
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', error);
                throw error;
            } finally {
                hideLoader();
            }
        }

        // –í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loginFirebase(username, password) {
            try {
                showLoader('–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É...');
                
                const userCredential = await auth.signInWithEmailAndPassword(
                    `${username}@welvura.com`, 
                    password
                );
                
                const user = userCredential.user;
                const userDoc = await db.collection('users').doc(user.uid).get();
                
                if (!userDoc.exists) {
                    throw new Error('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—Ö–æ–¥–∞
                await db.collection('users').doc(user.uid).update({
                    lastLogin: new Date().toISOString()
                });
                
                return { ...userDoc.data(), id: user.uid };
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:', error);
                throw error;
            } finally {
                hideLoader();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadUserFromFirebase(userId) {
            try {
                showLoader('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');
                
                const userDoc = await db.collection('users').doc(userId).get();
                
                if (!userDoc.exists) {
                    throw new Error('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }
                
                const userData = { ...userDoc.data(), id: userId };
                loginUser(userData);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
                auth.signOut();
            } finally {
                hideLoader();
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function saveUserToFirebase(user) {
            try {
                if (!user || !user.id) return false;
                
                // –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é –±–µ–∑ id –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                const userData = { ...user };
                delete userData.id;
                
                await db.collection('users').doc(user.id).update(userData);
                return true;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                return false;
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
        async function updateBalanceInFirebase(userId, newBalance) {
            try {
                await db.collection('users').doc(userId).update({
                    balance: roundToTwo(newBalance)
                });
                return true;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞:', error);
                return false;
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –∏—Å—Ç–æ—Ä–∏—é
        async function addToHistoryInFirebase(userId, game, won, amount, bet) {
            try {
                const historyItem = {
                    id: Date.now(),
                    game: game,
                    won: won,
                    amount: roundToTwo(amount),
                    bet: roundToTwo(bet),
                    time: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' }),
                    date: new Date().toLocaleDateString('ru-RU'),
                    timestamp: new Date().toISOString()
                };
                
                await db.collection('users').doc(userId).update({
                    gameHistory: firebase.firestore.FieldValue.arrayUnion(historyItem),
                    totalGames: firebase.firestore.FieldValue.increment(1),
                    wins: firebase.firestore.FieldValue.increment(won ? 1 : 0),
                    losses: firebase.firestore.FieldValue.increment(won ? 0 : 1)
                });
                
                return true;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏:', error);
                return false;
            }
        }

        // ========== –õ–û–ö–ê–õ–¨–ù–ê–Ø –ë–ê–ó–ê (FALLBACK) ==========
        function initLocalDatabase() {
            if (!localStorage.getItem('welvura_local_db')) {
                const initialDB = {
                    version: '1.0',
                    users: [],
                    lastUserId: 0
                };
                localStorage.setItem('welvura_local_db', JSON.stringify(initialDB));
            }
        }

        // ========== –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –§–£–ù–ö–¶–ò–ò –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ==========
        async function login() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!', 'error');
                return;
            }
            
            try {
                const user = await loginFirebase(username, password);
                showNotification(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${user.username}!`, 'success');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:', error);
                
                let errorMessage = '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞';
                if (error.code === 'auth/user-not-found') {
                    errorMessage = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω';
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å';
                } else if (error.code === 'auth/too-many-requests') {
                    errorMessage = '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ';
                }
                
                showNotification(errorMessage, 'error');
            }
        }

        async function register() {
            const username = document.getElementById('registerUsername').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            
            if (!username || !password || !confirmPassword) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!', 'error');
                return;
            }
            
            if (username.length < 3) {
                showNotification('–õ–æ–≥–∏–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 3 —Å–∏–º–≤–æ–ª–æ–≤!', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤!', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showNotification('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!', 'error');
                return;
            }
            
            try {
                const newUser = await registerFirebase(username, password);
                showNotification(`–ê–∫–∫–∞—É–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${username}!`, 'success');
                showLoginForm();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', error);
                
                let errorMessage = '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏';
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = '–ü–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º –ø—Ä–æ—Å—Ç–æ–π';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ª–æ–≥–∏–Ω';
                }
                
                showNotification(errorMessage, 'error');
            }
        }

        async function logout() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞?')) {
                try {
                    await auth.signOut();
                    currentUser = null;
                    showNotification('–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞', 'info');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:', error);
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ', 'error');
                }
            }
        }

        // ========== –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –°–û–•–†–ê–ù–ï–ù–ò–Ø –î–ê–ù–ù–´–• ==========
        async function saveUserData() {
            if (!currentUser) return;
            
            try {
                await saveUserToFirebase(currentUser);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', error);
                // Fallback –Ω–∞ localStorage
                localStorage.setItem('current_user_backup', JSON.stringify(currentUser));
            }
        }

        // ========== –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –ò–ì–†–û–í–´–ï –§–£–ù–ö–¶–ò–ò ==========
        async function playDice(choice) {
            if (!currentUser) return;
    
            currentBet = roundToTwo(currentBet);
            
            if (currentBet > currentUser.balance) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!', 'error');
                return;
            }
            
            if (currentBet < 0.01) {
                showNotification('–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞ 0.01 ‚ÇΩ', 'error');
                return;
            }
            
            showLoader('–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞–≤–∫–∏...');
            
            try {
                // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –≤ Firebase
                const newBalance = roundToTwo(currentUser.balance - currentBet);
                await updateBalanceInFirebase(currentUser.id, newBalance);
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ
                const randomNumber = Math.random() * 100;
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–±–µ–¥—É
                let win = false;
                if (choice === 'less') {
                    win = randomNumber < chance;
                } else {
                    win = randomNumber > (100 - chance);
                }
                
                let winAmount = 0;
                let finalBalance = newBalance;
                
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                if (win) {
                    const multiplier = roundToTwo(100 / chance);
                    winAmount = roundToTwo(currentBet * multiplier);
                    finalBalance = roundToTwo(newBalance + winAmount);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å —Å –≤—ã–∏–≥—Ä—ã—à–µ–º
                    await updateBalanceInFirebase(currentUser.id, finalBalance);
                    await addToHistoryInFirebase(currentUser.id, 'dice', true, winAmount, currentBet);
                    
                    showNotification(`üéâ –ü–û–ë–ï–î–ê! +${winAmount.toFixed(2)} ‚ÇΩ`, 'success');
                } else {
                    await addToHistoryInFirebase(currentUser.id, 'dice', false, currentBet, currentBet);
                    showNotification(`üí• –ü–†–û–ò–ì–†–´–® -${currentBet.toFixed(2)} ‚ÇΩ`, 'error');
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                currentUser.balance = finalBalance;
                currentUser.totalGames += 1;
                if (win) currentUser.wins += 1;
                else currentUser.losses += 1;
                
                updateBalance();
                updateMultipliers();
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é
                await loadUserFromFirebase(currentUser.id);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–≥—Ä—ã:', error);
                showNotification('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—Ç–∞–≤–∫–∏', 'error');
            } finally {
                hideLoader();
            }
        }

        // –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –æ–±–Ω–æ–≤–∏—Ç–µ –¥—Ä—É–≥–∏–µ –∏–≥—Ä–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
        // startMinesGame, cashoutMines, startCrashGame, cashoutCrash, playDoubleGame

        async function depositBalance(amount) {
            if (!currentUser) return;
            
            amount = roundToTwo(amount);
            if (amount <= 0) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—É—é —Å—É–º–º—É!', 'error');
                return;
            }
            
            showLoader('–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞...');
            
            try {
                const newBalance = roundToTwo(currentUser.balance + amount);
                await updateBalanceInFirebase(currentUser.id, newBalance);
                
                currentUser.balance = newBalance;
                updateBalance();
                
                showNotification(`‚úÖ –ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω –Ω–∞ ${amount.toFixed(2)} ‚ÇΩ`, 'success');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞', 'error');
            } finally {
                hideLoader();
            }
        }

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        document.addEventListener('DOMContentLoaded', async function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase
            await initializeFirebase();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—è MINES
            initMinesGrid();
            
            // –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
            setupEventListeners();
        });

        // ========== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ==========
        function setupEventListeners() {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ, –Ω–æ —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞—é—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
            // ... –≤–µ—Å—å –∫–æ–¥ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏–∑ –≤–∞—à–µ–≥–æ —Ñ–∞–π–ª–∞ ...
            
            // –¢–æ–ª—å–∫–æ –º–µ–Ω—è–µ–º –≤—ã–∑–æ–≤—ã –Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ç–∞–º, –≥–¥–µ –Ω—É–∂–Ω–æ
            document.getElementById('loginBtn').addEventListener('click', login);
            document.getElementById('registerBtn').addEventListener('click', register);
            document.getElementById('logoutBtn').addEventListener('click', logout);
            
            // –ò–≥—Ä–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏ —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞—é—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
            document.getElementById('diceLessBtn').addEventListener('click', () => playDice('less'));
            document.getElementById('diceMoreBtn').addEventListener('click', () => playDice('more'));
            
            // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–æ–º
            document.getElementById('resetBalanceBtn').addEventListener('click', async function() {
                if (!currentUser) return;
                
                if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –±–∞–ª–∞–Ω—Å –¥–æ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è (1000.00 ‚ÇΩ)?')) {
                    showLoader('–°–±—Ä–æ—Å –±–∞–ª–∞–Ω—Å–∞...');
                    try {
                        await updateBalanceInFirebase(currentUser.id, 1000.00);
                        currentUser.balance = 1000.00;
                        updateBalance();
                        showNotification('üîÑ –ë–∞–ª–∞–Ω—Å —Å–±—Ä–æ—à–µ–Ω –¥–æ 1000.00 ‚ÇΩ', 'info');
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ –±–∞–ª–∞–Ω—Å–∞:', error);
                        showNotification('–û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ –±–∞–ª–∞–Ω—Å–∞', 'error');
                    } finally {
                        hideLoader();
                    }
                }
            });
        }

        // ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
        // –≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ
        function roundToTwo(num) {
            return Math.round((num + Number.EPSILON) * 100) / 100;
        }

        function formatMoney(amount) {
            return roundToTwo(amount).toLocaleString('ru-RU', { 
                minimumFractionDigits: 2,
                maximumFractionDigits: 2 
            }) + ' ‚ÇΩ';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        // –§—É–Ω–∫—Ü–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ
        function showAuthPanel() {
            document.getElementById('authPanel').classList.add('active');
            document.getElementById('header').classList.remove('active');
            document.getElementById('navButtons').classList.remove('active');
            document.getElementById('gamesMenu').classList.remove('active');
            document.getElementById('betPanel').classList.remove('active');
            document.getElementById('gameArea').classList.remove('active');
            document.getElementById('historyPanel').classList.remove('active');
            document.getElementById('balanceControlPanel').classList.remove('active');
            document.getElementById('profilePanel').classList.remove('active');
            
            currentUser = null;
        }

        function showLoginForm() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('loginUsername').focus();
        }

        function showRegisterForm() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
            document.getElementById('registerUsername').focus();
        }

        function loginUser(user) {
            currentUser = user;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            document.getElementById('authPanel').classList.remove('active');
            document.getElementById('header').classList.add('active');
            document.getElementById('navButtons').classList.add('active');
            
            document.getElementById('usernameDisplay').textContent = user.username;
            document.getElementById('userId').textContent = `ID: ${user.id.substring(0, 6)}`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å
            updateProfileInfo();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
            updateBalance();
            updateMultipliers();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –∏–≥—Ä
            gameHistory = user.gameHistory || [];
            updateHistoryDisplay();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä—ã
            showSection('games');
        }

        function updateProfileInfo() {
            if (!currentUser) return;
            
            document.getElementById('profileUsername').textContent = currentUser.username;
            document.getElementById('profileUserId').textContent = currentUser.id.substring(0, 6);
            document.getElementById('profileRegDate').textContent = formatDate(currentUser.registerDate);
            document.getElementById('profileTotalGames').textContent = currentUser.totalGames || 0;
            document.getElementById('profileWins').textContent = currentUser.wins || 0;
            document.getElementById('profileLosses').textContent = currentUser.losses || 0;
        }

        // ========== –ö–û–ú–ê–ù–î–´ –î–õ–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø ==========
        window.addBalance = async function(amount) {
            if (currentUser) {
                await depositBalance(amount);
            } else {
                showNotification('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç!', 'error');
            }
        };

        // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
        console.log('%cüé∞ Welvura Casino v3.0', 'color: #3498db; font-size: 18px; font-weight: bold;');
        console.log('%c–û–±–ª–∞—á–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö Firebase:', 'color: #2ecc71; font-weight: bold;');
        console.log('- –†–µ–∞–ª—å–Ω–∞—è –æ–±–ª–∞—á–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö');
        console.log('- –ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞');
        console.log('- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏');
        console.log('- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö');
    </script>
</body>
</html>
